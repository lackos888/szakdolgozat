\Chapter{Tervezés}

A program az OO alapelveket igyekszik követni. Elsősorban modulokból áll, amelyek osztályként is értelmezhetőek. Vannak olyan modulok, amelyekben csak a helyi scopeban elérhető kódok vagy változók vannak, tehát "private" elérésűek.

A következőekben a modulok UML diagramját fogom külön-külön bemutatni. A következő \myref{fig:visibilityrules} ábrán tekinthetőek meg a láthatósági szabályok az UML diagramokon:
\begin{figure}[h!]
	\centering
	\begin{tikzpicture}
		\begin {class}[text width=0.35\textwidth]{Láthatósági szabályok}{0, 0}
			\attribute {- Private}
			\attribute {+ Public}
		\end {class}
	\end {tikzpicture}
	\caption{Láthatósági szabályok az UML diagramokon}
	\label{fig:visibilityrules}
\end{figure}

\Section{general, apt\_packages, utils modulok felépítése, feladata}

Legelőször a \detokenize{general, linux, apt_packages} és az utils modul került megtervezésre. Felépítésük \myaref{fig:generalandaptpackages} ábrán látható.

\begin{figure}[h!]
	\centering
	\begin{tikzpicture}
		\begin {class}[text width=0.455\textwidth]{general}{0, 0}
			\attribute {+ \detokenize{lineEnding : string}}
			\operation {+ \detokenize{getOSType()}}
			\operation {+ \detokenize{clearScreen()}}
			\operation {+ \detokenize{sleep(n)}}
			\operation {+ \detokenize{strSplit(str, sep)}}
			\operation {+ \detokenize{deepCompare(tbl1, tbl2)}}
			\operation {+ \detokenize{concatPaths(...) -> varargs}}
			\operation {+ \detokenize{extractDirFromPath(path)}}
			\operation {+ \detokenize{readAllFileContents(filePath)}}
			\operation {+ \detokenize{trim2(s)}}
		\end {class}
		\begin {class}[text width=0.44\textwidth]{\detokenize{apt_packages}}{7.8, 0}
			\operation {+ \detokenize{isPackageInstalled(packageName)}}
			\operation {+ \detokenize{installPackage(packageName)}}
		\end {class}
	\end {tikzpicture}
	\caption{A general és \detokenize{apt_packages} modul felépítése}
	\label{fig:generalandaptpackages}
\end{figure}

\pagebreak

A \texttt{general} modulban olyan funkciók és változók találhatóak, amelyek a legtöbb OS-en működnek, és fontos szerepet töltenek be a program működése közben.

Az \texttt{\detokenize{apt_packages}} modul Linux-specifikus kódokat tartalmaz, a modul feladata az apt program segítségével a csomagok menedzselése, telepítése.

Az \texttt{utils} modul legfőképp debugra volt használva, jelenleg épp nincs alkalmazva a program kódjában, így ezt a modult nem mutatom be.

\Section{linux modul felépítése, feladatai}

A következő \myref{fig:linux_module} számú UML diagramon a \texttt{linux} nevezetű modult fogom bemutatni, amely linux-specifikus kódrészleteket tartalmaz. Erre a modulra épül a legtöbb modul.

\begin{figure}[h!]
\centering
	\begin{tikzpicture}[scale=0.85, every node/.style={scale=0.85}]
		\begin {class}[text width=0.9\textwidth]{linux}{0, 0}
			\operation {+ \detokenize{exists(file)}}
			\operation {+ \detokenize{isDir(path)}}
			\operation {+ \detokenize{listDirFiles(path)}}
			\operation {+ \detokenize{mkDir(path)}}
			\operation {+ \detokenize{deleteFile(path))}}
			\operation {+ \detokenize{deleteDirectory(path)}}
			\operation {+ \detokenize{execCommand(cmd)}}
			\operation {+ \detokenize{getServiceStatus(serviceName)}}
			\operation {+ \detokenize{isServiceRunning(serviceName)}}
			\operation {+ \detokenize{isProcessRunning(name)}}
			\operation {+ \detokenize{stopService(serviceName)}}
			\operation {+ \detokenize{startService(serviceName)}}
			\operation {+ \detokenize{restartService(serviceName)}}
			\operation {+ \detokenize{systemctlDaemonReload()}}
			\operation {+ \detokenize{checkIfUserExists(userName)}}
			\operation {+ \detokenize{createUserWithName(userName, comment, shell, homeDir)}}
			\operation {+ \detokenize{updateUser(userName, comment, shell)}}
			\operation {+ \detokenize{getUserHomeDir(userName)}}
			\operation {+ \detokenize{execCommandWithProcRetCode(cmd, linesReturned, envVariables, redirectStdErrToStdIn)}}
			\operation {+ \detokenize{copy(from, to)}}
			\operation {+ \detokenize{copyAndChown(user, from, to)}}
			\operation {+ \detokenize{chown(path, userName, isDir)}}
			\operation {+ \detokenize{chmod(path, perm, isDir)}}
		\end {class}
	\end {tikzpicture}
	\caption{A linux modul felépítése}
	\label{fig:linux_module}
\end{figure}

A \texttt{linux} modul feladatai szerteágazóak:

\begin{itemize}
	\item vannak benne fájl- és könyvtár manipulációs funkciók
	\item vannak benne parancsfuttató funkciók (amelyek közül az egyik tökéletesen kompatibilis Windows-sal is), továbbá servicet és systemctlt kezelő funkciók
	\item vannak benne felhasználókat módosító funkciók (felhasználók létrehozása, módosítása, felhasználó létezésének ellenőrzése, felhasználó home dir lekérése)
	\item vannak benne ownershipet változtató funkciók
	\item vannak benne fájl és mappa hozzáférési szabályokat változtató funkciók
\end{itemize}

\Section{OpenVPN modulok felépítései, feladatai}

A következőekben az OpenVPN szerver kezelését kezdtem el megtervezni, implementálni. Az összes modul a program jegyzékén belül a \textbf{modules/vpnHandler} jegyzékben található meg.

Több részmodulra lett szétosztva:
\begin{itemize}
	\item \textbf{OpenVPN}: ez maga \texttt{bootstrap} modul, ebben van OpenVPN csomagot feltelepítő funkció, szervert indító/leállító funkció, továbbá ez a modul tölti be a \texttt{\detokenize{server_impl}} modult
	\item \textbf{\detokenize{server_impl}}: ez a modul kezeli a szerverrel kapcsolatos legtöbb dolgot
	
	előkészíti a könyvtárakat, feltelepíti az Easy-RSA Certificate kezelőt, létrehoz egy saját CA-t (\texttt{Certificate Authority}-t), szerver-oldali certificate és kulcsfájlokat generál, saját OpenVPN usert hoz létre a szervernek, tls-auth/tls-crypt kulcsot generál, a server configot beüzemeli, beállítja a server daemon auto-startot a \texttt{/etc/default/openvpn} fájlban

	\item \textbf{\detokenize{config_handler}}: az OpenVPN szerver és kliens konfigját kezelő modul, config parselést és writeolást implementál. A parser és writer az eredeti OpenVPN parser kódja alapján épült, amely megtalálható a \cite{openvpn_parser} hivatkozás alatt.
	\item \textbf{\detokenize{clienthandler_impl}}: ez a modul kezeli teljesen a klienssel kapcsolatos dolgokat:
	
	kliens certificatet, private keyt hoz létre; kliens konfigot hoz létre, amelybe beembeddeli a generált fájlok tartalmát (így 1 db config filera van szüksége az OpenVPN kliensnek); certificate revoket támogat; továbbá le lehet kérni az összes jelenlegi klienst, amelyek valósak (nincsenek revokeolva)
\end{itemize}

Maga az OpenVPN \texttt{bootstrap} és \texttt{\detokenize{config_handler}} modul nagyon egyszerű felépítésű, amely látható is a következő \myref{fig:openvpn_module} és \myref{fig:openvpn_config_handler_module} ábrán. 
\begin{figure}[h!]
\centering
	\begin{tikzpicture}[scale=0.83, every node/.style={scale=0.83}]
		\begin {class}[text width=0.7\textwidth]{OpenVPN}{0, 0}
			\attribute {+ \detokenize{errors : table}}
			\attribute {+ \detokenize{serverImpl -> }\textbf{OpenVPN\_server\_impl} module}
			\operation {+ \detokenize{isOpenVPNInstalled()}}
			\operation {+ \detokenize{installOpenvpn()}}
			\operation {+ \detokenize{isRunning()}}
			\operation {+ \detokenize{stopServer()}}
			\operation {+ \detokenize{startServer()}}
			\operation {+ \detokenize{initDirs()}}
		\end {class}
	\end {tikzpicture}
	\caption{Az OpenVPN bootstrap modul felépítése}
	\label{fig:openvpn_module}
\end{figure}

\begin{figure}[h!]
\centering
	\begin{tikzpicture}[scale=0.83, every node/.style={scale=0.83}]
		\begin {class}[text width=0.7\textwidth]{\detokenize{OpenVPN_config_handler}}{0, 0}
			\operation {+ \detokenize{parseOpenVPNConfig(linesInStr)}}
			\operation {+ \detokenize{writeOpenVPNConfig(parsedLines)}}
		\end {class}
	\end {tikzpicture}
	\caption{Az \detokenize{OpenVPN_config_handler} bootstrap modul felépítése}
	\label{fig:openvpn_config_handler_module}
\end{figure}

A \texttt{\detokenize{server_impl}} modul minden OpenVPN szerverrel kapcsolatos művelet magja, ezért sok funkcióval rendelkezik. Felépítése \myaref{fig:openvpn_server_impl_module} ábrán látható. 

A klienseket kezelő \texttt{\detokenize{OpenVPN_clienthandler_impl}} modulban pedig két osztály is helyet foglal az OO alapelveket követve. Felépítése \myaref{fig:openvpn_clienthandler_impl_module} ábrán látható.

\begin{figure}[h]
	\centering
	\begin{tikzpicture}[scale=0.84, every node/.style={scale=0.84}]
		\begin {class}[text width=1\textwidth]{\detokenize{OpenVPN_server_impl}}{0, 0}
			\attribute {- \detokenize{bootstrapModule -> }\textbf{\detokenize{OpenVPN}} module}
			\attribute {- \detokenize{caPass : string}}
			\attribute {- \detokenize{serverKeyPass : string}}
			\attribute {- \detokenize{sampleConfigFileContent : string}}
			\attribute {+ \detokenize{errors : table}}
			\operation {- \detokenize{registerNewError(errorName)}}
			\operation {- \detokenize{getConfigFilePath(openVPNConfigDir)}}
			\operation {+ \detokenize{constructor(_bootstrapModule)}}
			\operation {+ \detokenize{resolveErrorToStr(error)}}
			\operation {+ \detokenize{getEasyRSADir()}}
			\operation {+ \detokenize{getCAPass()}}
			\operation {+ \detokenize{getOpenVPNBaseConfigDir()}}
			\operation {+ \detokenize{isEasyRSAInstalled()}}
			\operation {+ \detokenize{formatPathInsideEasyRSAInstallCache(path)}}
			\operation {+ \detokenize{formatPathInsideBasedir(path)}}
			\operation {+ \detokenize{initDirs()}}
			\operation {+ \detokenize{installEasyRSA()}}
			\operation {+ \detokenize{getEasyRSAPKiDir()}}
			\operation {+ \detokenize{initEasyRSA()}}
			\operation {+ \detokenize{enableAllAutostartInDefault()}}
			\operation {+ \detokenize{getOpenVPNSubnet()}}
			\operation {+ \detokenize{checkServerConfig(homeDir, openVPNConfigDir)}}
			\operation {+ \detokenize{checkOpenVPNUserExistence()}}
			\operation {+ \detokenize{createOpenVPNUser(homeDir)}}
			\operation {+ \detokenize{updateExistingOpenVPNUser()}}
			\operation {+ \detokenize{getOpenVPNHomeDir()}}
			\operation {+ \detokenize{initializeServer()}}
		\end {class}
	\end {tikzpicture}
	\caption{Az \detokenize{OpenVPN_server_impl} modul felépítése}
	\label{fig:openvpn_server_impl_module}
\end{figure}

\begin{figure}[h!]
	\centering
	\begin{tikzpicture}[scale=0.84, every node/.style={scale=0.84}]
		\begin {class}[text width=0.458\textwidth]{\detokenize{OpenVPN_clienthandler_impl}}{0, 0}
			\attribute {- \detokenize{clientObjects : table}}
			\attribute {- \detokenize{validClients : table}}
			\attribute {- \detokenize{clientSampleConfig : string}}
			\attribute {+ \detokenize{errors : table}}
			\attribute {+ \detokenize{Client -> }\textbf{class}}
			\operation {- \detokenize{getValidClientsFromPKIDatabase()}}
			\operation {- \detokenize{registerNewError(errorName)}}
			\operation {+ \detokenize{constructor(openVPNServerImpl)}}
			\operation {+ \detokenize{resolveErrorToStr(error)}}
			\operation {+ \detokenize{updateRevokeCRLForOpenVPNDaemon()}}
			\operation {+ \detokenize{getValidClients()}}
		\end {class}
		\begin {class}[text width=0.44\textwidth]{\detokenize{Client}}{8, 0}
			\attribute {- \detokenize{clientObjects : table}}
			\attribute {- \detokenize{validClients : table}}
			\attribute {- \detokenize{clientSampleConfig : string}}
			\attribute {+ \detokenize{errors : table}}
			\operation {+ \detokenize{new(clientName, loadedFromPKI)}}
			\operation {+ \detokenize{genKeyAndCRT(password)}}
			\operation {+ \detokenize{generateClientConfig()}}
			\operation {+ \detokenize{revoke()}}
			\operation {+ \detokenize{isValidClient()}}	
		\end {class}
		\unidirectionalAssociation{OpenVPN_clienthandler_impl}{}{}{Client}
	\end {tikzpicture}
	\caption{Az \detokenize{OpenVPN_clienthandler_impl} modul felépítése}
	\label{fig:openvpn_clienthandler_impl_module}
\end{figure}

\pagebreak

\Section{nginx modulok felépítései, feladatai}

Az nginx-et kezelő modulok is több részre lettek osztva. Az összes modul a program jegyzékén belül a \textbf{modules/nginxHandler} jegyzékben található meg. A modulok leírásai, feladatokkal:
\begin{itemize}
	\item \textbf{nginx}: ez maga egy \texttt{bootstrap} modul, ebben van nginx csomagot feltelepítő funkció, szervert leállító/elindító funkció, továbbá ez a modul tölti be a \\\texttt{\detokenize{server_impl}} modult
	\item \textbf{\detokenize{server_impl}}: ez a modul kezeli a szerverrel kapcsolatos legtöbb dolgot
	
	előkészíti a könyvtárakat, létrehoz az nginx daemonnak, workereknek egy usert; támogatja automatikusan a weboldalak létrehozását, törlését; támogatja az SSL-t; minden támogatott featuret bekonfigurál automatikusan

	\item \textbf{\detokenize{config_handler}}: nginx szerver konfigját kezelő modul, config parselést és writeolást implementál. A parser és writer az eredeti nginx parser kódja alapján épült, amely megtalálható a \cite{nginx_parser} hivatkozás alatt
\end{itemize}

Az nginx \texttt{bootstrap} modul ezesetben is egyszerű felépítésű, amely látszik \myaref{fig:nginx_module} ábráról is. 

Azonban a \texttt{\detokenize{config_handler}} modul ebben az esetben már kissé bonyolultabb, mivel az nginx syntaxa is komplikáltabb. Két osztályt tartalmaz. Felépítése \myaref{fig:nginx_config_handler_module} ábrán látható.

\begin{figure}[h!]
	\centering
	\begin{tikzpicture}[scale=0.87, every node/.style={scale=0.87}]
		\begin {class}[text width=0.45\textwidth]{nginx}{0, 0}
			\attribute {+ \detokenize{errors : table}}
			\attribute {+ \detokenize{serverImpl -> }\textbf{nginx\_server\_impl} module}
			\operation {+ \detokenize{isInstalled()}}
			\operation {+ \detokenize{install()}}
			\operation {+ \detokenize{isRunning()}}
			\operation {+ \detokenize{stopServer()}}
			\operation {+ \detokenize{startServer()}}
			\operation {+ \detokenize{initDirs()}}
		\end {class}
	\end {tikzpicture}
	\caption{Az nginx bootstrap modul felépítése}
	\label{fig:nginx_module}
\end{figure}

\begin{figure}[h!]
	\centering
	\begin{tikzpicture}[scale=0.87, every node/.style={scale=0.87}]
		\begin {class}[text width=0.45\textwidth]{\detokenize{nginx_config_handler}}{0, 0}
			\attribute {+ \detokenize{nginxConfigHandler -> }\textbf{nginxConfigHandler} class}
			\operation {- \detokenize{concatArgsProperlyForBlockName(args)}}
			\operation {- \detokenize{parseNginxConfig(linesInStr)}}
			\operation {- \detokenize{formatDataAccordingQuoting(tbl)}}
			\operation {- \detokenize{doPaddingWithBlockDeepness(blockDeepness)}}
			\operation {- \detokenize{writeNginxConfig(parsedLines)}}
		\end {class}

		\begin {class}[text width=0.44\textwidth]{\detokenize{nginxConfigHandler}}{7.5, 0}
			\operation {+ \detokenize{new(linesInStr, paramToLine)}}
			\operation {+ \detokenize{getParsedLines()}}
			\operation {+ \detokenize{getParamsToIdx()}}
			\operation {+ \detokenize{insertNewData(dataTbl, pos)}}
			\operation {+ \detokenize{deleteData(pos)} - jelenleg nem használt}
			\operation {+ \detokenize{toString()}}
		\end {class}
		
		\unidirectionalAssociation{nginx_config_handler}{}{}{nginxConfigHandler}	
	\end {tikzpicture}
	\caption{Az \detokenize{nginx_config_handler} modul felépítése}
	\label{fig:nginx_config_handler_module}
\end{figure}

\pagebreak

A következő \myref{fig:nginx_server_impl_module} ábrán látható a \texttt{\detokenize{nginx_server_impl}} modul felépítése:

\begin{figure}[h!]
	\centering
	\begin{tikzpicture}[scale=0.95, every node/.style={scale=0.95}]
		\begin {class}[text width=0.7\textwidth]{\detokenize{nginx_server_impl}}{0, 0}
			\attribute {- \detokenize{sampleConfigForWebsite : string}}
			\attribute {+ \detokenize{nginxUser : string}}
			\attribute {+ \detokenize{nginxUserComment : string}}
			\attribute {+ \detokenize{nginxUserShell : string}}
			\attribute {+ \detokenize{baseDir : string}}
			\attribute {+ \detokenize{errors : table}}
			\operation {- \detokenize{registerNewError(errorName)}}
			\operation {+ \detokenize{constructor(_bootstrapModule)}}
			\operation {+ \detokenize{resolveErrorToStr(error)}}
			\operation {+ \detokenize{formatPathInsideBasedir(path)}}
			\operation {+ \detokenize{initDirs()}}
			\operation {+ \detokenize{checkNginxUserExistence()}}
			\operation {+ \detokenize{createNginxUser(homeDir)}}
			\operation {+ \detokenize{updateExistingNginxUser()}}
			\operation {+ \detokenize{getNginxHomeDir()}}
			\operation {+ \detokenize{getNginxMasterConfigPathFromDaemon()}}
			\operation {+ \detokenize{initializeServer()}}
			\operation {+ \detokenize{createNewWebsite(websiteUrl)}}
			\operation {+ \detokenize{deleteWebsite(websiteUrl)}}
			\operation {+ \detokenize{getCurrentAvailableWebsites()}}
			\operation {+ \detokenize{initSSLForWebsite(webUrl, certDetails)}}
		\end {class}
	\end {tikzpicture}
	\caption{Az \detokenize{nginx_server_impl} modul felépítése}
	\label{fig:nginx_server_impl_module}
\end{figure}

\Section{apache modulok felépítései, feladatai}

Az apache kezeléséhez tartozó modulok a program jegyzékén belül a \textbf{modules/apacheHandler} jegyzékben található meg.

A modulok leírásai, feladatokkal:
\begin{itemize}
	\item \textbf{apache}: ez maga egy \texttt{bootstrap} modul, ebben van apache2 csomagot feltelepítő funkció, szervert leállító/elindító funkció, továbbá ez a modul tölti be a \texttt{\detokenize{server_impl}} modult
	\item \textbf{\detokenize{server_impl}}: ez a modul kezeli a szerverrel kapcsolatos legtöbb dolgot:
	
	előkészíti a könyvtárakat, létrehoz az apache2 daemonnak, processeknek egy usert\\támogatja automatikusan a weboldalak létrehozását, törlését; támogatja az SSL-t; minden támogatott featuret bekonfigurál automatikusan (envvars-t is)

	\item \textbf{\detokenize{config_handler}}: apache szerver konfigját kezelő modul:\\Config parselést és writeolást implementál. Az apache2 szerver parsere az előzőleg tárgyalt programokhoz képest bonyolultabb, ezért teljesen az alapoktól terveztem a parsert és a writert. Ehhez az apache2 config syntax dokumentációját vettem segítségül, amely megtalálható a \cite{apache_configuring} hivatkozás alatt.
	\\Az envvars nevű fájl szerkesztését implementáló class is ebben a modulban van.
\end{itemize}

\pagebreak

Az apache \texttt{bootstrap} modul ezesetben is egyszerű felépítésű, a \texttt{\detokenize{config_handler}} pedig három osztályt tartalmaz. A \texttt{\detokenize{server_impl}} modul hasonló bonyolultságú az \\\texttt{\detokenize{nginx_server_impl}} modulhoz. Felépítésük megtekinthető \myaref{fig:apache_modules} ábrán.
	
\begin{figure}[h!]
	\centering
	\begin{tikzpicture}[scale=0.95, every node/.style={scale=0.95}]
		\begin {class}[text width=0.45\textwidth]{apache}{0, 0}
			\attribute {+ \detokenize{errors : table}}
			\attribute {+ \detokenize{serverImpl -> }\textbf{apache\_server\_impl} module}
			\operation {+ \detokenize{isInstalled()}}
			\operation {+ \detokenize{install()}}
			\operation {+ \detokenize{isRunning()}}
			\operation {+ \detokenize{stopServer()}}
			\operation {+ \detokenize{startServer()}}
			\operation {+ \detokenize{initDirs()}}
		\end {class}
		
		\begin {class}[text width=0.45\textwidth]{\detokenize{apache_config_handler}}{7.6, 0}
			\attribute {+ \detokenize{apacheConfigHandler -> }\textbf{apacheConfigHandler} class}
			\attribute {+ \detokenize{apacheEnvvarsHandler -> }\textbf{apacheEnvvarsHandler} class}
			\operation {- \detokenize{parseApacheConfig(linesInStr)}}
			\operation {- \detokenize{doPaddingWithBlockDeepness(blockDeepness)}}
			\operation {- \detokenize{formatDataAccordingQuoting(tbl)}}
			\operation {- \detokenize{writeApacheConfig(parsedLines)}}
			\operation {- \detokenize{parse_envvar_args_from_line(line)}}
			\operation {- \detokenize{escapeMagic(s)}}
		\end {class}
		
		\begin {class}[text width=0.45\textwidth]{\detokenize{apacheConfigHandler}}{0, -6.5}
			\operation {+ \detokenize{new(linesInStr, paramToLine)}}
			\operation {+ \detokenize{getParsedLines()}}
			\operation {+ \detokenize{getParamsToIdx()}}
			\operation {+ \detokenize{insertNewData(dataTbl, pos)}}
			\operation {+ \detokenize{deleteData(pos)} - jelenleg nem használt}
			\operation {+ \detokenize{toString()}}
		\end {class}
		
		\begin {class}[text width=0.45\textwidth]{\detokenize{apacheEnvvarsHandler}}{7.6, -7}
			\operation {+ \detokenize{new(linesInStr)}}
			\operation {+ \detokenize{getArgs()}}
			\operation {+ \detokenize{toString()}}
		\end {class}
		
		\begin {class}[text width=0.45\textwidth]{\detokenize{apache_server_impl}}{7.6, -10.3}
			\attribute {+ \detokenize{apacheUser : string}}
			\attribute {+ \detokenize{apacheUserComment : string}}
			\attribute {+ \detokenize{apacheUserShell : string}}
			\attribute {+ \detokenize{baseDir : string}}
			\attribute {+ \detokenize{errors : table}}
			\attribute {- \detokenize{sampleConfigForWebsite : string}}
			\operation {- \detokenize{resolveErrorToStr(error)}}
			\operation {+ \detokenize{constructor(_bootstrapModule)}}
			\operation {+ \detokenize{formatPathInsideBasedir(path)}}
			\operation {+ \detokenize{checkApacheUserExistence()}}
			\operation {+ \detokenize{createApacheUser(homeDir)}}
			\operation {+ \detokenize{updateExistingApacheUser()}}
			\operation {+ \detokenize{getApacheHomeDir()}}
			\operation {+ \detokenize{getApacheMasterConfigPathFromDaemon()}}
			\operation {+ \detokenize{initDirs()}}
			\operation {+ \detokenize{initializeServer()}}
			\operation {+ \detokenize{createNewWebsite(websiteUrl)}}
			\operation {+ \detokenize{deleteWebsite(websiteUrl)}}
			\operation {+ \detokenize{getCurrentAvailableWebsites()}}
			\operation {+ \detokenize{initSSLForWebsite(webUrl, certDetails)}}
		\end {class}

		\unidirectionalAssociation{apache_config_handler}{}{}{apacheConfigHandler}
		\unidirectionalAssociation{apache_config_handler}{}{}{apacheEnvvarsHandler}
	\end {tikzpicture}
	\caption{Az apache implementáció moduljainak felépítése}
	\label{fig:apache_modules}
\end{figure}

\pagebreak

\Section{certbot modul felépítése, feladata}

A certbot csak egy modult foglal magában. Működéséhez több modult is felhasznál. A modulban megtalálható a certbot telepítése snapd-n keresztül, symlink létrehozás, SSL certificate létrehozás HTTP-01 challenge és DNS challenge segítségével, továbbá be is konfigurálja az adott webszervereket a használathoz.

Habár a certbot akár az \texttt{apt} package managerrel is felrakható, az \texttt{apt-get install certbot} parancs segítségével, maga a program weboldalán a leírás szerint snapd-vel telepítik. \cite{certbot_install_debian}

A különbség főképp a kettő között az, hogy az \texttt{apt} package manager deb csomagokkal dolgozik, a \texttt{snap} pedig teljes archívumokkal. Teljesen külön repository-kal dolgoznak.

Az \texttt{apt} esetében a függőségek külön rakódnak fel a csomagok feltelepítésekor, és a \texttt{deb} archívumok csak a csomagokat tartalmazzák. Ebben az esetben a frissítések késhetnek, mivel több szervezet, személy is átnézi a frissítés tartalmát.

A \texttt{snapd} esetében egy teljes archívumot tölt le a rendszer, ebben benne van a csomag összes függősége pont azzal a verzióval, amellyel a csomag fejlesztői szerették volna. Ez az archívum egy "zárt térbe" kerül kicsomagolásra, és limitált hozzáférése van magához a rendszerhez (hasonlóan a Docker-alkalmazásokhoz). Frissítéskor a fejlesztő adja ki a frissítéseket, nem validálják őket külön, ezáltal gyorsabban eljut a userekhez. \cite{snap_vs_apt}

A \texttt{certbot} modul UML diagramja a következő \myref{fig:certbot_module} ábrán látható:
	
\begin{figure}[h!]
	\centering
	\begin{tikzpicture}%[scale=0.95, every node/.style={scale=0.95}]
		\begin {class}[text width=0.6\textwidth]{\detokenize{certbot}}{0, 0}
			\attribute {- \detokenize{errors : table}}
			\attribute {- \detokenize{certFileName : string}}
			\attribute {- \detokenize{keyFileName : string}}
			\attribute {- \detokenize{dhParamFileName : string}}
			\attribute {- \detokenize{dryRunStr : string} - kizárólag debugra}
			\operation {- \detokenize{registerNewError(errorName)}}
			\operation {- \detokenize{sleep(n)}}
			\operation {+ \detokenize{resolveErrorToStr(error)}}
			\operation {+ \detokenize{isCertbotInstalled()}}
			\operation {+ \detokenize{createCertbotSymlink()}}
			\operation {+ \detokenize{installCertbot()}}
			\operation {+ \detokenize{getCertDatas(domain)}}
			\operation {+ \detokenize{trySSLCertificateCreation(method, domain, webserverType)}}
			\operation {+ \detokenize{init()}}
		\end {class}
	\end {tikzpicture}
	\caption{A certbot modul felépítése}
	\label{fig:certbot_module}
\end{figure}

\Section{snapd modul felépítése, feladata}

A snapd modul egyszerű felépítésű. Feladata maga a snapd feltelepítése az \texttt{apt} package manager segítségével, továbbá csomagok telepítése, és a már feltelepített csomagok meglétének ellenőrzése.

\pagebreak

A \texttt{snapd} modul UML diagramja a következő \myref{fig:snapd_module} ábrán található meg:
	
\begin{figure}[h!]
	\centering
	\begin{tikzpicture}%[scale=0.95, every node/.style={scale=0.95}]
		\begin {class}[text width=0.6\textwidth]{\detokenize{snapd}}{0, 0}
			\operation {+ \detokenize{isSnapdInstalled()}}
			\operation {+ \detokenize{installSnapd()}}
			\operation {+ \detokenize{isPackageInstalled(packageName)}}
			\operation {+ \detokenize{installPackage(packageName, classic)}}
		\end {class}
	\end {tikzpicture}
	\caption{A snapd modul felépítése}
	\label{fig:snapd_module}
\end{figure}

\Section{iptables modul felépítése, feladata}

Ez a modul kezeli a tűzfalszabályokat az \texttt{iptables} frontend segítségével. Funkcionalitása maga az iptables telepítése, a portok nyitása/zárása, kimenő/bemenő csomagok szűrése, továbbá a NAT előkészítése az OpenVPN szerver számára. 

A modul UML diagramja \myaref{fig:iptables_module} ábrán tekinthető meg:

\begin{figure}[h!]
	\centering
	\begin{tikzpicture}[scale=0.9, every node/.style={scale=0.9}]
		\begin {class}[text width=0.9\textwidth]{\detokenize{iptables}}{0, 0}
			\attribute {- \detokenize{iptablesAliases : table}}
			\attribute {+ \detokenize{errors : table}}
			\operation {+ \detokenize{resolveErrorToStr(error)}}
			\operation {+ \detokenize{isIptablesInstalled()}}
			\operation {+ \detokenize{installIptables()}}
			\operation {+ \detokenize{getCurrentNetworkInterfaces()}}
			\operation {+ \detokenize{getCurrentSSHPorts()}}
			\operation {+ \detokenize{parseCurrentRules()}}
			\operation {+ \detokenize{getOpenPorts(interface)}}
			\operation {+ \detokenize{deleteOpenPortRule(interface, idx)}}
			\operation {+ \detokenize{getClosedPorts(interface)}}
			\operation {+ \detokenize{deleteClosePortRule(interface, idx)}}
			\operation {+ \detokenize{closePort(interface, protocol, dport, fromIP)}}
			\operation {+ \detokenize{openPort(interface, protocol, dport, fromIP)}}
			\operation {+ \detokenize{listAllowedOutgoingConnections(interface)}}
			\operation {+ \detokenize{deleteOutgoingRule(interface, idx)}}
			\operation {+ \detokenize{allowOutgoingNewConnection(interface, protocol, dip, dport)}}
			\operation {+ \detokenize{checkIfInboundPacketsAreBeingFilteredAlready(interface, protocol)}}
			\operation {+ \detokenize{togOnlyAllowAcceptedPacketsInbound(toggle, interface, protocol)}}
			\operation {+ \detokenize{checkIfOutboundPacketsAreBeingFilteredAlready(interface, protocol)}}
			\operation {+ \detokenize{togOnlyAllowAcceptedPacketsOutbound(toggle, interface, protocol)}}
			\operation {+ \detokenize{deleteNATRules(mainInterface, tunnelInterface, forwardTblIdx, forwardTblAllIdx, postroutingTblAllIdx)}}
			\operation {+ \detokenize{getCurrentActiveNATForOpenVPN()}}
			\operation {+ \detokenize{initNATForOpenVPN(mainInterface, tunnelInterface, openvpnSubnet)}}
			\operation {+ \detokenize{loadOurRulesToIptables()}}
			\operation {+ \detokenize{iptablesToString()}}
			\operation {+ \detokenize{initModule()}}
		\end {class}
	\end {tikzpicture}
	\caption{Az iptables modul felépítése}
	\label{fig:iptables_module}
\end{figure}